<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Gravity Effect Click</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
	$(function() {
		var box = $("#box");
		var direction = 1;
		var distance = 500;
		var timer;
		$("#baseline").css({
			top : distance
		});
		$(document).click(function() {
			clearInterval(timer);
			timer = gravity(distance, box, direction);
			direction = -direction;			
		})

		function gravity(distance, target, direction) {
			//加速度g为0.378pixel/ms2，相当10m/s2
			var g = 0.378, h = distance, vs = 0, initH = 0, i = 0;
			var t = Math.floor(Math.sqrt((2 * h / g)));
			var first = true;
			if (direction === 1) {
				initH = 0;
			} else if (direction === -1) {
				initH = distance;
			}
			var timer = setInterval(function() {
				if (i < t) {
					target.css("top", initH + direction * (-vs * i + 0.5 * g * i * i));
// 					console.info(target.position().top);
					i++;
				} else {
					if (first) {
						first = false;
						if (direction === 1) {
							initH = distance;
						} else if (direction === -1) {
							initH = 0;
						}
					}
					target.css("top", initH);
					h = h / 2;
					if (h < 1) {
						clearInterval(timer);
					}
					vs = Math.sqrt(2 * g * h);
					t = Math.floor(2 * Math.sqrt((2 * h / g)));
					i = 0;
				}
			}, 1);
			return timer;
		}
	})
</script>
<style type="text/css">
body {
	position: relative;
	margin: 0;
}

#box {
	width: 100px;
	height: 100px;
	margin: 0 auto;
	position: relative;
	background-color: blue;
}

hr {
	margin: 0;
	position: relative;
}
</style>
</head>
<body>
	<div id="box"></div>
	<hr id="baseline" />
</body>
</html>